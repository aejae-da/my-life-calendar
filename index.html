<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>body { margin: 0; background: #000; display: flex; justify-content: center; }</style>
</head>
<body>
    <canvas id="wallpaper" width="1080" height="2340" style="display:none;"></canvas>
    <img id="output" style="width: 100vw; height: auto;" />

    <script>
        const canvas = document.getElementById('wallpaper');
        const ctx = canvas.getContext('2d');
        const imgDisplay = document.getElementById('output');

        const config = {
            width: 1080,
            height: 2340,
            startY: 1050,     // Pushed down further to clear widgets
            footerY: 2100,    
            columns: 14,
            dotRadius: 13,
            spacing: 45,      // Slightly tighter spacing to ensure grid fits
            bgColor: "#121212",
            dotPast: "#FFFFFF",
            dotToday: "#FF4500",
            dotFuture: "#333333",
            textDays: "#FF4500", 
            textPercent: "#333333" 
        };

        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 0);
        const diff = now - start;
        const oneDay = 1000 * 60 * 60 * 24;
        const dayOfYear = Math.floor(diff / oneDay);
        const isLeap = (now.getFullYear() % 4 === 0);
        const totalDays = isLeap ? 366 : 365;

        // 1. Draw Background
        ctx.fillStyle = config.bgColor;
        ctx.fillRect(0, 0, config.width, config.height);

        // 2. Draw Dots
        const startX = (config.width - (config.columns - 1) * config.spacing) / 2;
        for (let i = 0; i < totalDays; i++) {
            const row = Math.floor(i / config.columns);
            const col = i % config.columns;
            const x = startX + col * config.spacing;
            const y = config.startY + row * config.spacing;

            ctx.beginPath();
            ctx.arc(x, y, config.dotRadius, 0, Math.PI * 2);
            if (i < dayOfYear - 1) ctx.fillStyle = config.dotPast;
            else if (i === dayOfYear - 1) ctx.fillStyle = config.dotToday;
            else ctx.fillStyle = config.dotFuture;
            ctx.fill();
        }

        // 3. Draw Footer (Fixed Overlap & Split Color)
        const daysLeftStr = `${totalDays - dayOfYear}d left `; // Added space
        const percentStr = `Â· ${Math.floor((dayOfYear / totalDays) * 100)}%`;
        
        ctx.font = "bold 34px Helvetica";
        const daysWidth = ctx.measureText(daysLeftStr).width;
        const percentWidth = ctx.measureText(percentStr).width;
        const totalTextWidth = daysWidth + percentWidth;
        
        // Calculate centered start position for the whole string
        const textStartX = (config.width - totalTextWidth) / 2;

        ctx.textBaseline = "middle";
        ctx.textAlign = "left";

        // Draw Part 1: Red/Orange
        ctx.fillStyle = config.textDays;
        ctx.fillText(daysLeftStr, textStartX, config.footerY);

        // Draw Part 2: Grey
        ctx.fillStyle = config.textPercent;
        ctx.fillText(percentStr, textStartX + daysWidth, config.footerY);

        imgDisplay.src = canvas.toDataURL("image/png");
    </script>
</body>
</html>